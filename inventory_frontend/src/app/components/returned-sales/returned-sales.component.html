<div class="d-flex flex-row justify-content-between page-header">
    <h4>فواتير مرتجع العملاء</h4>
</div>
<main class="my-3">
    <p-table dir="rtl"  
    responsiveLayout="scroll" 
    [value]="returnsInvoices" 
    
    [paginator]="true" 
    [rows]="10" 
    [lazy]="true"
    (onLazyLoad)="loadData($event)"
    [totalRecords]="paginationOptions.totalRecords">

    <ng-template pTemplate="caption">
        <div  class="table-header row justify-content-between align-items-center px-4">
            <span class="p-input-icon-left filter-container col-md-6">
                <p-dropdown  [showClear]="true" (onChange)="filterInvoices($event)" 
                (onClear)="cancelFilter()"  appendTo="body" placeholder="تصفية الفواتير" 
                [options]="filterTypes"
                optionLabel="name" [(ngModel)]="selectedFilterType"></p-dropdown>
            </span>
            <div class=" total-invoices col-md-6">
                <h5>اجمالي المرتجع</h5>
                <h4 class="text-danger">{{totalSum | number:'1.0':'en-US'}} جنية</h4>
            </div>
        </div>
    </ng-template>
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th>رقم الفاتورة</th>
                <th>التاريخ </th>
                <th>السلعة </th>
                <th>اجمالي المرتجع</th>
                <th>المخزن</th>
                <th>مضيف الفاتورة</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item let-columns="columns">
            <tr>
                <td><strong>{{item.invoice.invoiceId}}</strong></td>
                <td style="direction: ltr;" >
                    <span *ngIf="item.returnDate">
                        {{item.returnDate | date:'dd-MM-YYYY' }} {{item.returnDate | date:'hh:mm a' }}
                    </span>
                    <span *ngIf="!item.returnDate">
                        -
                    </span>
                </td>
                <td>
                    <span class="badge badge-warning">{{item.product.productName + "  "}} 
                        {{item.product.manufacturerCountery}} <br> 
                        <span class="my-2"> عدد القطع x<strong>{{item.quantity}}</strong> </span> <br>
                        <span class="my-1"> {{item.product.piecePrice}} جنية للقطعة</span> 
                    </span> 
                </td>
                
                <td>{{item.fee}} جنية </td>
                <td>{{item.storage?item.storage.storageName:'الجميع'}}</td>
                <td>{{item.user.fullName}} {{item.user.type == "admin"?'ادمن' :'كاشير' }}</td>
                
              </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage" let-columns>
            <tr>
                <td class="transparent-bkg" [attr.colspan]="returnsInvoices?.length">
                    لا توجد بيانات بعد
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="summary">
            <div class="p-d-flex p-ai-center p-jc-between">
                الاجمالي {{returnsInvoices ? returnsInvoices.length : 0 }}
            </div>
        </ng-template>
    </p-table>
</main>
